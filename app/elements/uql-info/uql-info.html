<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-ajax/core-ajax.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="/bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="/bower_components/core-icons/core-icons.html">
<link rel="import" href="/bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-from-right.html">


<link rel="import" href="../../elements/uql-holds/uql-holds.html">
<link rel="import" href="../../elements/uql-fines/uql-fines.html">
<link rel="import" href="../../elements/uql-loans/uql-loans.html">


<polymer-element name="uql-info" layout center attributes="apiUrl">
  <template>
    <core-ajax auto url="{{ apiUrl }}"
               params=''
               id="ajax"
               handleAs="json" on-core-response="{{ infoLoaded }}"></core-ajax>
    <style>
      :host {
        display: block;
        padding: 0px;
        max-width: 350px;
        height: 350px;
      }

      core-header-panel {
        height: 100%;
        border-radius: 5%;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        background: #E5E5E5;
      }
      core-toolbar {
        background: #03a9f4;
        color: white;

      }
      paper-tabs {
        background: #03a9f4;
      }

      .infoWrapper {
        padding: 20px;

      }

      #overviewList {
        -webkit-padding-start: 20px;
      }

      #overviewList li{
        height: 40px;

      }
      #tabs {
        width: 100%;
        margin: 0;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        text-transform: uppercase;
      }

      section#overview uql-holds {
        background: red;
      }

    </style>

    <core-header-panel>
      <core-toolbar>
        <paper-tabs id="tabs" selected="{{ selectedTab }}" on-core-select="{{ tabSelected }}">
          <paper-tab name="overview" id="overview">Overview</paper-tab>
          <paper-tab name="holds" id="holds">Holds</paper-tab>
          <paper-tab name="loans" id="loans">Loans</paper-tab>
          <paper-tab name="fines" id="fines">Fines</paper-tab>
        </paper-tabs>
      </core-toolbar>

      <div class="infoWrapper">
        <core-animated-pages id="animatedPages" transitions="slide-from-right">

          <section id="overview" name="overview" hidden?="{{ selectedTab != 'overview' }}">
            <uql-holds id="holds" holds="{{ holds }}" view="teaser"></uql-holds>
            <uql-loans rel="tab" loans="{{ loans }}"></uql-loans>
            <uql-fines fines="{{ fines }}"></uql-fines>
          </section>

          <section id="holds" name="holds" class="holds" hidden?="{{ selectedTab != 'holds' }}">
            <uql-holds holds="{{ holds }}"></uql-holds>
          </section>

          <section id="loans" name="loans" class="loans" hidden?="{{ selectedTab != 'loans' }}">
            <uql-loans loans="{{ loans }}"></uql-loans>
          </section>

          <section id="fines" name="fines" class="loans"  class="fines" hidden?="{{ selectedTab != 'fines' }}">
            <uql-fines fines="{{ fines }}"></uql-fines>
          </section>

        </core-animated-pages>

     </div>
    </core-header-panel>
  </template>

  <script>
    Polymer('uql-info', {

      apiUrl : '../../mock/info.json',

      selectedTab : 'overview',
      infoLoaded : function() {
        var response = this.$.ajax.response;
        this.holds = (response.holds ? response.holds : []);
        this.loans = (response.chekedOut ? response.chekedOut : []);
        this.fines = (response.fines ? response.fines : []);
        console.log(response);
      },

      tabSelected : function() {
        this.selectedTab = this.$.tabs.selected;
        this.$.animatedPages.selected = this.$.tabs.selected;
      },

      ready: function() {
        tabs = this.$.tabs;
        this.$.overview.addEventListener('toggle-view', function(e) {
          tabs.selected = e.detail.source;
        });
      },

      changeTab : function (event, details, sender) {
        this.selectedTab = 'loans';
      }
    });
  </script>

</polymer-element>