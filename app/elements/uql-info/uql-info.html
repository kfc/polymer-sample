<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-ajax/core-ajax.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="/bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="/bower_components/core-icons/core-icons.html">
<link rel="import" href="/bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-from-right.html">


<link rel="import" href="../../elements/uql-holds/uql-holds.html">
<link rel="import" href="../../elements/uql-fines/uql-fines.html">
<link rel="import" href="../../elements/uql-loans/uql-loans.html">


<polymer-element name="uql-info" layout center attributes="apiUrl">
  <template>

    <core-ajax auto url="{{ apiUrl }}"
               params=''
               id="ajax"
               handleAs="json" on-core-response="{{ infoLoaded }}"></core-ajax>

    <link rel="stylesheet" href="/styles/uql-info.css">
    <style>
      :host {
        display: block;
        padding: 0px;
        max-width: 350px;
      }
      core-header-panel {
        border-radius: 5px;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        background: #FFFFFF;
        border: 1px solid #03a9f4;
        max-height: 400px;
        height: 275px;
      }
      core-toolbar {
        background: #03a9f4;
        color: white;
        display: block;

      }

      paper-tabs#tabs {
        width: 100%;
        margin: 0;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        text-transform: uppercase;
        background: #03a9f4;
        display: block;
      }

      .infoWrapper {
      }

      #overviewList {
        -webkit-padding-start: 20px;
      }

      #overviewList li{
      }


      #overview div:nth-child(odd){
        background-color: #FFF;
      }
      #overview div:nth-child(even){
        background-color: #f5f5f5;
      }



    </style>

    <core-header-panel vertival layout>
      <div>
      <core-toolbar>
        <paper-tabs id="tabs" selected="{{ selectedTab }}" on-core-select="{{ tabSelected }}">
          <paper-tab name="overview" id="overview">Overview</paper-tab>
          <paper-tab name="holds" id="holds">Holds</paper-tab>
          <paper-tab name="loans" id="loans">Loans</paper-tab>
          <paper-tab name="fines" id="fines">Fines</paper-tab>
        </paper-tabs>
      </core-toolbar>
      </div>

      <div class="infoWrapper">
        <core-animated-pages id="animatedPages" transitions="slide-from-right" block>

          <section id="overview" name="overview" hidden?="{{ selectedTab != 'overview' }}">
          <div>
            <uql-holds holds="{{ holds }}" view="teaser"></uql-holds>
          </div>
          <div>
            <uql-loans loans="{{ loans }}" view="teaser"></uql-loans>
          </div>
          <div>
            <uql-fines fines="{{ fines }}" view="teaser"></uql-fines>
          </div>
          </section>

          <section id="holds" name="holds" class="holds" hidden?="{{ selectedTab != 'holds' }}">
            <uql-holds holds="{{ holds }}"></uql-holds>
          </section>

          <section id="loans" name="loans" class="loans" hidden?="{{ selectedTab != 'loans' }}">
            <uql-loans loans="{{ loans }}"></uql-loans>
          </section>

          <section id="fines" name="fines" class="fines" hidden?="{{ selectedTab != 'fines' }}">
            <uql-fines fines="{{ fines }}"></uql-fines>
          </section>

        </core-animated-pages>

     </div>
    </core-header-panel>
  </template>

  <script>
    Polymer('uql-info', {

      apiUrl : '../../mock/info.json',

      selectedTab : 'overview',
      infoLoaded : function() {
        var response = this.$.ajax.response;
        this.holds = (response.holds ? response.holds : []);
        this.loans = (response.checkedOut ? response.checkedOut : []);
        this.fines = (response.fines ? response.fines : []);
        console.log(response);
      },

      tabSelected : function() {
        this.selectedTab = this.$.tabs.selected;
        this.$.animatedPages.selected = this.$.tabs.selected;
      },

      ready: function() {
        tabs = this.$.tabs;
        this.$.overview.addEventListener('toggle-view', function(e) {
          tabs.selected = e.detail.source;
        });
      },
    });
  </script>

</polymer-element>